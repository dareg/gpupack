#!/bin/bash
#
# A plug-in for gmkpack to import the source code at the time of the 
# creation of the pack.
# The format of the source code file(s) is supposed to be pre-determined
# by the plug-in.

# from the CNRM webdav at Meteo-France, in Mister Ryad's directory ;-)
# Therefore only 'administrative pack' are concerned so far
# Modified : 05-Jun-2008 R. El Khatib : use wget to improve the flexibility : no need
# to have .public mounted before.

TMPDIR=${TMPDIR:=$HOME/tmp}
if [ "$ROOTPACK" = "$HOMEPACK" ] ; then
# name of the source code
  if [ "$MAINPACK" ] ; then
    BASENAME=${RELEASE_NUMBER}_${BRANCH}.${VERSUS}
  else
    BASENAME=${RELATIVE_TARGET_PACK}.${VERSUS}@${RELEASE_NUMBER}_${BRANCH}.${LATEST}
  fi
  NAME=${BASENAME}.tgz
  DIRNAME="http://webdav.cnrm.meteo.fr/public/algo/khatib/src"
# Import
  cd $TMPDIR
  wget --http-user anonymous --http-passwd mto $DIRNAME/$NAME
  if [ -s $NAME ] ; then
    cd $TARGET_PACK/$GMKSRC/$GMKLOCAL
    tar xvfz $TMPDIR/$NAME
    \rm $TMPDIR/$NAME
  else
    echo "The source code to import \"${NAME}\"is missing."
    exit 1
  fi
fi
